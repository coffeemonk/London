$((function(){"use strict";player(!1),document.addEventListener("swup:contentReplaced",e=>{$((function(){player(!0)}))})}));const enumPlayState={PLAYING:"playing",PAUSED:"paused",LOADING:"loading"};var $player,$playerAudio,$episode,timeListener,currentTime=0,currentId=0,playState=enumPlayState.PAUSED;function player(e){"use strict";($player=$(".audioPlayer")).isExternal=$player.hasClass("external"),$player.speed=1,$episode=$player.isExternal?currentId?$('.episode[data-id="'+currentId+'"]'):null:$player,$playerAudio=$player.find("audio");var a=$player.find(".progress"),t={current:$player.find(".time .current"),duration:$player.find(".time .duration")};e?($player.isExternal&&playState==enumPlayState.PLAYING&&html.addClass("player-opened"),currentTime&&($player.isExternal||$player.data("id")==currentId)&&($playerAudio[0].currentTime=currentTime,t.current.text(formatTime(currentTime)),$player.isExternal&&updateExternalPlayer($episode,currentId),playState==enumPlayState.PLAYING&&($playerAudio.attr("src")||$playerAudio.attr("src",$episode.data("url")),togglePlayback())),e=!1):(currentTime=0,t.current.text(formatTime(0))),$(".js-play").on("click",(function(){var e,a,t=jQuery(this);if($episode&&$episode.data("currentTime",currentTime),!$episode||$player.isExternal){var r=t.closest(".episode");1==r.length&&($episode=r)}$episode&&(e=$episode.data("id"),a=$episode.data("url"),e!==currentId&&a&&(currentId=e,$player.addClass(enumPlayState.LOADING),$episode.addClass(enumPlayState.LOADING),$(".episode").removeClass(enumPlayState.PLAYING),currentTime=$episode.data("currentTime")||0,$playerAudio.attr("src",a),updateExternalPlayer()),$player.isExternal&&html.addClass("player-opened"),togglePlayback())})),$playerAudio.on("loadedmetadata",(function(){$playerAudio[0].removeEventListener("timeupdate",timeListener);var e=$playerAudio[0].duration;t.duration.text(formatTime(e)),$playerAudio[0].currentTime=$episode.data("currentTime")?$episode.data("currentTime")-1:currentTime,timeListener=$playerAudio[0].addEventListener("timeupdate",(function(r){currentTime=r.target.currentTime,t.current.text(formatTime(currentTime)),a.css("width",currentTime/e*100+"%")}))})),$player.find(".button.backward").on("click",(function(){$playerAudio[0].currentTime=$playerAudio[0].currentTime-10})),$player.find(".button.forward").on("click",(function(){$playerAudio[0].currentTime=$playerAudio[0].currentTime+30}));var r=$player.find(".button.speed");r.on("click",(function(){$player.speed<2?$player.speed+=.5:$player.speed=1,$playerAudio[0].playbackRate=$player.speed,r.text($player.speed+"x")})),$player.find(".button.close").on("click",(function(){togglePlayback(pause=!0),html.removeClass("player-opened")}))}function updateExternalPlayer(){if($player.isExternal){var e=$player.find(".post-image"),a=$player.find(".post-header .title .link"),t=$player.find(".post-header .meta"),r=$episode.find(".post-image").data("srcset");r&&(e.attr("data-srcset",r),lazySizes.loader.unveil(e[0]));var i=$episode.find(".link").text();i&&a.text(i);var n=$episode.find(".meta").html();n&&t.html(n)}}function togglePlayback(e=!1){var a=$playerAudio[0];if(a)if(e||!a.paused)a.pause(),playState=null,$("."+enumPlayState.PLAYING).removeClass(enumPlayState.PLAYING);else{var t=a.play();void 0!==t&&t.then((function(){playState=enumPlayState.PLAYING,$player.addClass(playState),$player.isExternal&&$episode.addClass(playState),$("."+enumPlayState.LOADING).removeClass(enumPlayState.LOADING)})).catch((function(e){console.log(e)}))}}function formatTime(e){return new Date(1e3*e).toISOString().substr(11,8)}
//# sourceMappingURL=player.js.map